let currentQuestionIndex = 0;
let questions = [];
let timer;
let selectedAnswer = null;
let score = 0;

async function fetchQuestions() {
    const response = await fetch('https://opentdb.com/api.php?amount=45&category=18&difficulty=easy&type=multiple');
    const data = await response.json();
    questions = data.results;
    shuffleArray(questions);
    displayCurrentQuestion();
}

function displayCurrentQuestion() {
    if (currentQuestionIndex < questions.length) {
        const currentQuestion = questions[currentQuestionIndex];
        const questionElement = document.querySelector('.titolo');
        const optionsElement = document.getElementById('formClick');
        const numDomandeElement = document.querySelector('.num_domande');
        const nextButton = document.getElementById('bottone');

        questionElement.textContent = currentQuestion.question;
        numDomandeElement.textContent = `Question ${currentQuestionIndex + 1}/${questions.length}`;

        const allOptions = [currentQuestion.correct_answer, ...currentQuestion.incorrect_answers];
        shuffleArray(allOptions);
        optionsElement.innerHTML = '';

        allOptions.forEach(option => {
            const button = document.createElement('button');
            button.className = 'option-button';
            button.textContent = option;
            button.onclick = () => selectAnswer(option, currentQuestion.correct_answer, button);
            optionsElement.appendChild(button);
        });

        nextButton.disabled = true;
        startTimer();
    } else {
        // Quiz completato
        const quizContainer = document.getElementById('contenin2');
      

        const resultPage = document.createElement('div');
        resultPage.className = 'result-page';
        resultPage.textContent = `Quiz completato. Punteggio finale: ${score} su ${questions.length}`;
        document.body.appendChild(resultPage);
    }
}

function selectAnswer(selectedOption, correctAnswer, button) {
    if (selectedAnswer) {
        selectedAnswer.style.backgroundColor = '';
    }

    button.style.backgroundColor = 'pink';
    selectedAnswer = button;
    const nextButton = document.getElementById('bottone');
    nextButton.disabled = false;
    resetTimer();

    if (selectedOption === correctAnswer) {
        score++;
        // Puoi gestire la risposta corretta qui se necessario
    }
}

function startTimer() {
    const timerElement = document.getElementById('timer');
    let timeLeft = 60;
    timerElement.textContent = timeLeft;

    timer = setInterval(() => {
        timeLeft--;
        timerElement.textContent = timeLeft;

        if (timeLeft <= 0) {
            clearInterval(timer);
            currentQuestionIndex++;
            displayCurrentQuestion();
        }
    }, 1000);
}

function resetTimer() {
    clearInterval(timer);
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

fetchQuestions();